<div class="floor-plan-toolbar">
  @if (roomId()) {
    <span class="toolbar-info-label">Location:</span>
    <span class="toolbar-info-value">{{ selectedLocationName() }}</span>
    <span class="toolbar-info-sep"></span>
    <span class="toolbar-info-label">Room:</span>
    <span class="toolbar-info-value">{{ selectedRoomName() }}</span>
  } @else {
    <label for="location-select">Location:</label>
    <select
      id="location-select"
      [ngModel]="selectedLocationId()"
      (ngModelChange)="locationChange.emit($event)"
    >
      <option [ngValue]="null">-- Seleziona Location --</option>
      @for (loc of locations(); track loc.id) {
        <option [ngValue]="loc.id">{{ loc.name }}</option>
      }
    </select>
    <label for="room-select">Room:</label>
    <select
      id="room-select"
      [disabled]="!selectedLocationId()"
      [ngModel]="selectedRoomId()"
      (ngModelChange)="roomChange.emit($event)"
    >
      <option [ngValue]="null">-- Seleziona Room --</option>
      @for (room of rooms(); track room.id) {
        <option [ngValue]="room.id">{{ room.name }}</option>
      }
    </select>
  }

  <button
    class="btn-save"
    (click)="save.emit()"
    [disabled]="!selectedRoomId() || saveStatus() === 'saving'"
  >
    {{ saveStatus() === "saving" ? "Salvataggio..." : "Salva Planimetria" }}
  </button>

  <label class="autosave-toggle">
    <input
      type="checkbox"
      [checked]="autosave()"
      (change)="autosaveChange.emit($any($event.target).checked)"
    />
    <span class="switch-track">
      <span class="switch-thumb"></span>
    </span>
    <span class="switch-label">Autosalvataggio</span>
  </label>

  @if (saveStatus() === "saved") {
    <span class="save-feedback save-ok">‚úì Salvato</span>
  }
  @if (saveStatus() === "error") {
    <span class="save-feedback save-err">‚úó Errore nel salvataggio</span>
  }

  @if (activeTool() === "rack") {
    <span class="rack-picker-sep"></span>
    <label for="rack-select" class="rack-picker-label">üñ•Ô∏è Modello rack:</label>
    @if (rackTypes().length === 0) {
      <span class="rack-picker-empty">Nessun modello rack disponibile</span>
    } @else {
      <select
        id="rack-select"
        class="rack-picker-select"
        [ngModel]="selectedRackType()"
        (ngModelChange)="rackTypeChange.emit($event)"
      >
        @for (rackType of rackTypes(); track rackType.id) {
          <option [ngValue]="rackType">
            {{ rackType.model }} ({{ rackType.width }}√ó{{ rackType.height }} cm,
            {{ rackType.capacity }}U)
          </option>
        }
      </select>
    }
  }

  @if (activeTool() === "door") {
    <span class="rack-picker-sep"></span>
    <label class="rack-picker-label">üö™ Larghezza varco:</label>
    <input
      type="number"
      class="door-width-input"
      [ngModel]="doorWidth()"
      (ngModelChange)="doorWidthChange.emit($event)"
      min="20"
      max="2000"
      step="10"
    />
    <span class="rack-picker-label">cm</span>
  }
</div>
