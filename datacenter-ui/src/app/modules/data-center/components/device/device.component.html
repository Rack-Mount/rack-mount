@if (device(); as dev) {
  <div
    [class]="
      'device device--' +
      typeClass() +
      (dev.device_image ? ' device--has-image' : '')
    "
    (mouseenter)="showTooltip()"
    (mouseleave)="hideTooltip()"
  >
    <!-- Coloured accent bar on the left edge (always visible) -->
    <div class="device__type-bar" aria-hidden="true"></div>

    @if (activeImage(); as img) {
      <!-- ── Front/rear-panel image mode: full-bleed photo ── -->
      <div class="device__panel">
        <img
          class="device__panel-img"
          [src]="serviceUrl + '/files/' + img"
          [alt]="dev.device_hostname"
        />
      </div>
      <!-- Overlay lives outside device__panel to escape its overflow:hidden -->
      <div class="device__overlay" aria-hidden="true">
        <span class="device__overlay-hostname">{{ dev.device_hostname }}</span>
        @if (dev.device_model) {
          <span class="device__overlay-model">{{ dev.device_model }}</span>
        }
      </div>
    } @else {
      <!-- ── Fallback: icon + text ── -->
      <div class="device__body">
        <span class="device__icon" aria-hidden="true">{{ typeIcon() }}</span>
        <div class="device__info">
          <span class="device__hostname">{{ dev.device_hostname }}</span>
        </div>
      </div>
    }

    <!-- Hover tooltip (shown for both modes) -->
    @if (tooltipVisible) {
      <div
        [class]="
          'device__tooltip' +
          (tooltipFlipped ? ' device__tooltip--flipped' : '')
        "
        role="tooltip"
        [style.top.px]="tooltipTop"
        [style.left.px]="tooltipLeft"
      >
        @if (dev.device_hostname) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Host</span>
            <span class="device__tooltip-value">{{ dev.device_hostname }}</span>
          </div>
        }
        @if (dev.device_model) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Model</span>
            <span class="device__tooltip-value">{{ dev.device_model }}</span>
          </div>
        }
        @if (dev.device_vendor) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Vendor</span>
            <span class="device__tooltip-value">{{ dev.device_vendor }}</span>
          </div>
        }
        @if (dev.device_type) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Type</span>
            <span class="device__tooltip-value">{{ dev.device_type }}</span>
          </div>
        }
        @if (dev.device_rack_units) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Units</span>
            <span class="device__tooltip-value"
              >{{ dev.device_rack_units }}U</span
            >
          </div>
        }
        @if (dev.device_serial_number) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">Serial</span>
            <span class="device__tooltip-value device__tooltip-value--mono">{{
              dev.device_serial_number
            }}</span>
          </div>
        }
        @if (dev.device_sap_id) {
          <div class="device__tooltip-row">
            <span class="device__tooltip-label">SAP ID</span>
            <span class="device__tooltip-value device__tooltip-value--mono">{{
              dev.device_sap_id
            }}</span>
          </div>
        }
      </div>
    }
  </div>
}
