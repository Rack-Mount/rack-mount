<div class="rack-install-backdrop" (click)="close()"></div>

<div
  class="rack-install"
  [style.top.px]="anchorY()"
  [style.left.px]="anchorX()"
  (click)="$event.stopPropagation()"
>
  <div class="rack-install__header">
    <span class="rack-install__title">{{
      "install_panel.title" | translate: { pos: position() }
    }}</span>
    <button class="rack-install__close" (click)="close()">✕</button>
  </div>

  <div class="rack-install__search">
    <input
      type="text"
      class="rack-install__input"
      [placeholder]="'install_panel.search_placeholder' | translate"
      [value]="_search()"
      (input)="onSearch($any($event.target).value)"
      autofocus
    />
  </div>

  <div class="rack-install__list">
    @if (_assetsState().status === "loading") {
      <div class="rack-install__loading">
        {{ "install_panel.loading" | translate }}
      </div>
    } @else if (_assetsState().status === "error") {
      <div class="rack-install__empty">
        {{ "install_panel.error" | translate }}
      </div>
    } @else if (
      installableAssets().length === 0 && _assetsState().status === "loaded"
    ) {
      <div class="rack-install__empty">
        {{ "install_panel.no_assets" | translate }}
      </div>
    } @else {
      @for (asset of installableAssets(); track asset.id) {
        <div
          class="rack-install__item"
          [class.rack-install__item--selected]="_selectedId() === asset.id"
          [class.rack-install__item--disabled]="isTooLarge(asset)"
          (click)="!isTooLarge(asset) && selectAndInstall(asset.id)"
        >
          @if (asset.model.front_image) {
            <img
              class="rack-install__thumb"
              [src]="asset.model.front_image + '?w=80'"
              alt=""
              loading="lazy"
            />
          } @else {
            <div class="rack-install__thumb rack-install__thumb--empty"></div>
          }
          <div class="rack-install__info">
            <span class="rack-install__hostname">{{
              asset.hostname || "—"
            }}</span>
            <span class="rack-install__meta"
              >{{ asset.model.name }} &middot;
              {{ asset.model.rack_units ?? "?" }}U</span
            >
            @if (asset.serial_number) {
              <span class="rack-install__serial"
                >S/N: {{ asset.serial_number }}</span
              >
            }
            @if (isTooLarge(asset)) {
              <span class="rack-install__too-large">{{
                "install_panel.too_large" | translate: { u: availableU() }
              }}</span>
            }
          </div>
        </div>
      }
    }
  </div>

  @if (_error()) {
    <div class="rack-install__error">{{ _error() }}</div>
  }

  <div class="rack-install__footer">
    @if (_saving()) {
      <span class="rack-install__saving">{{
        "install_panel.installing" | translate
      }}</span>
    }
    <button
      class="rack-install__btn rack-install__btn--cancel"
      (click)="close()"
    >
      {{ "install_panel.cancel" | translate }}
    </button>
  </div>
</div>
